{"version":3,"file":"module.js","sources":["../../src/ts/constants.ts","../../src/ts/apps/displayTokenActions.ts","../../src/ts/apps/selectiveShow.ts","../../src/ts/apps/displayActions.ts","../../src/ts/socket.ts","../../src/ts/module.ts"],"sourcesContent":["import {name} from '../module.json';\r\n\r\nexport const moduleId = name;\r\nexport const moduleName = 'DisplayActions2e';\r\nexport const socketEvent = `module.${moduleId}`;\r\n","import {TokenDocumentPF2e} from '../../../types/src/module/token-document';\r\nimport {DisplayActions2eData} from '../types';\r\nimport {DisplayActions2e} from './displayActions';\r\n\r\nexport class DisplayTokenActions2e extends DisplayActions2e {\r\n  private tokenId: string;\r\n\r\n  constructor(tokenId: string, newState?: DisplayActions2eData) {\r\n    super(newState);\r\n    this.isLinkedToActor = true;\r\n    this.tokenId = tokenId;\r\n    console.log(this.tokenId);\r\n  }\r\n\r\n  override get title(): string {\r\n    let title = game.i18n.localize('DisplayActions2e.WindowTitle');\r\n    if (this.state.sentFromUserId === game.userId) {\r\n      return title;\r\n    }\r\n\r\n    let name = canvas.data.tokens.find((token: TokenDocumentPF2e) => {\r\n      return token.data._id === this.tokenId;\r\n    });\r\n\r\n    return title.concat(' for ', String(name));\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>): void {\r\n    super.activateListeners(html);\r\n    // register events for all users with permission\r\n    if (this.state.userListPermissions.includes(String(game.userId))) {\r\n      html.find('img.symbol').on('click', this._onClickSymbolImage.bind(this));\r\n      html.find('input.input-counter').on('change', this._onChangeCountNumber.bind(this));\r\n    }\r\n  }\r\n\r\n  override getData() {\r\n    this.updateState();\r\n\r\n    return {\r\n      numOfActions: this.state.numOfActions,\r\n      numOfReactions: this.state.numOfReactions,\r\n      actionImagePayload: this.buildHandlebarPayload(\r\n        this.state.numOfActions,\r\n        {actionImage: this.actionImage},\r\n        this.state.classNameListActions,\r\n      ),\r\n      reactionImagePayload: this.buildHandlebarPayload(\r\n        this.state.numOfReactions,\r\n        {reactionImage: this.reactionImage},\r\n        this.state.classNameListReactions,\r\n      ),\r\n      isLinkedToActor: this.isLinkedToActor,\r\n    };\r\n  }\r\n}\r\n","/* original by FVTT-SelectiveShow */\r\n\r\nimport {moduleId, socketEvent} from '../constants';\r\nimport {DisplayActions2eData, EmitData} from '../types';\r\n\r\nexport class SelectiveShowApp extends FormApplication {\r\n  private userNameList: string[];\r\n  private displayActionState: DisplayActions2eData;\r\n\r\n  constructor(users: string[], state: DisplayActions2eData) {\r\n    super(users);\r\n    this.userNameList = users;\r\n    this.displayActionState = state;\r\n  }\r\n\r\n  static override get defaultOptions() {\r\n    const options = super.defaultOptions;\r\n    options.id = 'DisplayActions2e-selective-show';\r\n    options.template = `modules/${moduleId}/templates/selectiveshow.html`;\r\n    options.classes?.push('selective-show');\r\n    options.height = 300;\r\n    options.width = 250;\r\n    options.minimizable = true;\r\n    options.resizable = true;\r\n    options.title = game.i18n.localize('selectiveshow.SelectiveShow');\r\n    return options;\r\n  }\r\n\r\n  override async getData() {\r\n    let data = await super.getData();\r\n    // üëáÔ∏è ts-ignore ignores any ts errors on the next line\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    data.users = game.users.filter(u => u.active && u.data.id != game.user.id);\r\n    return data;\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n\r\n    html.find('.show').click(ev => {\r\n      ev.preventDefault();\r\n      this._updateObject();\r\n      // let selector = $(ev.currentTarget).parents('form').find('select');\r\n      game.socket?.emit(socketEvent, {\r\n        operation: 'showToSelection',\r\n        state: this.displayActionState,\r\n        user: game.userId,\r\n        userList: this.userNameList,\r\n      } as EmitData);\r\n      this.close();\r\n    });\r\n    html.find('.show-all').click(ev => {\r\n      ev.preventDefault();\r\n      this._updateObject();\r\n\r\n      game.socket?.emit(socketEvent, {\r\n        operation: 'showToAll',\r\n        state: this.displayActionState,\r\n        user: game.userId,\r\n      } as EmitData);\r\n\r\n      this.close();\r\n    });\r\n\r\n    html.find('.show-permissions').click(ev => {\r\n      ev.preventDefault();\r\n      this._updateObject();\r\n\r\n      this.displayActionState.userListPermissions = this.userNameList;\r\n\r\n      game.socket?.emit(socketEvent, {\r\n        operation: 'showWithPermission',\r\n        state: this.displayActionState,\r\n        user: game.userId,\r\n        userList: this.userNameList,\r\n      } as EmitData);\r\n\r\n      this.close();\r\n    });\r\n  }\r\n\r\n  protected override _updateObject(): Promise<unknown> {\r\n    let selector = Array.from(\r\n      document.getElementsByClassName('selective-show-form')[0].children[0].children[0].children[0].children,\r\n    ) as HTMLOptionElement[];\r\n    this.userNameList = selector.map((element: HTMLOptionElement) => {\r\n      // üëáÔ∏è ts-ignore ignores any ts errors on the next line\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      if (element.selected) {\r\n        return element.value;\r\n      }\r\n      return '';\r\n    });\r\n\r\n    // active User Id needs to be send always\r\n    let activeUserId = game.userId;\r\n    if (activeUserId) {\r\n      if (!this.userNameList.includes(activeUserId)) {\r\n        this.userNameList.push(activeUserId);\r\n      }\r\n    }\r\n    return new Promise<unknown>(() => {});\r\n  }\r\n\r\n  _handleShowPlayers(state: DisplayActions2eData) {\r\n    this.render(true);\r\n    this.displayActionState = state;\r\n  }\r\n}\r\n","import {TokenDocumentPF2e} from '../../../types/src/module/token-document';\r\nimport {moduleId, socketEvent} from '../constants';\r\nimport {DisplayActions2eData, EmitData} from '../types';\r\nimport {DisplayTokenActions2e} from './displayTokenActions';\r\nimport {SelectiveShowApp} from './selectiveShow';\r\n\r\nexport class DisplayActions2e extends Application {\r\n  protected clickString = 'symbolClick';\r\n  protected actionImage = '/systems/pf2e/icons/actions/OneAction.webp';\r\n  protected reactionImage = '/systems/pf2e/icons/actions/Reaction.webp';\r\n  protected defaultNumOfActions = 3;\r\n  protected defaultNumOfReactions = 1;\r\n  protected isLinkedToActor = false;\r\n\r\n  protected state: DisplayActions2eData = {\r\n    numOfActions: this.defaultNumOfActions,\r\n    numOfReactions: this.defaultNumOfReactions,\r\n    classNameListActions: Array.from({length: this.defaultNumOfActions}, () => 'symbol'),\r\n    classNameListReactions: Array.from({length: this.defaultNumOfReactions}, () => 'symbol'),\r\n    sentFromUserId: String(game.userId),\r\n    userListPermissions: [String(game.userId)],\r\n  };\r\n\r\n  protected showPlayerHandler: SelectiveShowApp = new SelectiveShowApp([String(game.user?.data.name)], this.state);\r\n\r\n  constructor(newState?: DisplayActions2eData, linked = false) {\r\n    super();\r\n    this.isLinkedToActor = linked;\r\n\r\n    if (newState) {\r\n      this.state = newState;\r\n    }\r\n  }\r\n\r\n  override get title(): string {\r\n    let title = game.i18n.localize('DisplayActions2e.WindowTitle');\r\n    if (this.state.sentFromUserId === game.userId) {\r\n      return title;\r\n    }\r\n\r\n    let name = game.users?.find(user => {\r\n      return user.data._id === this.state.sentFromUserId;\r\n    })?.data.name;\r\n\r\n    return title.concat(' sent from ', String(name));\r\n  }\r\n\r\n  static override get defaultOptions(): ApplicationOptions {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'DisplayActions2e',\r\n      template: `modules/${moduleId}/templates/result.hbs`,\r\n      width: 600,\r\n      height: 200,\r\n      resizable: true,\r\n      title: 'DisplayActions2e.WindowTitle',\r\n    }) as ApplicationOptions;\r\n  }\r\n\r\n  override getData() {\r\n    this.updateState();\r\n\r\n    return {\r\n      numOfActions: this.state.numOfActions,\r\n      numOfReactions: this.state.numOfReactions,\r\n      actionImagePayload: this.buildHandlebarPayload(\r\n        this.state.numOfActions,\r\n        {actionImage: this.actionImage},\r\n        this.state.classNameListActions,\r\n      ),\r\n      reactionImagePayload: this.buildHandlebarPayload(\r\n        this.state.numOfReactions,\r\n        {reactionImage: this.reactionImage},\r\n        this.state.classNameListReactions,\r\n      ),\r\n      isLinkedToActor: this.isLinkedToActor,\r\n    };\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>): void {\r\n    super.activateListeners(html);\r\n    // register events for all users with permission\r\n    if (this.state.userListPermissions.includes(String(game.userId))) {\r\n      html.find('img.symbol').on('click', this._onClickSymbolImage.bind(this));\r\n      html.find('input.input-counter').on('change', this._onChangeCountNumber.bind(this));\r\n      // html.find('button.actorLink').on('click', DataWrapper2e.createApplications.bind(DataWrapper2e));\r\n      html.find('button.actorLink').on('click', this._onButtonClickSelectedActors.bind(this));\r\n    }\r\n  }\r\n\r\n  protected _onClickSymbolImage(event: Event) {\r\n    event.preventDefault();\r\n    // switch css classes of the images\r\n    const image = event.currentTarget as HTMLImageElement;\r\n    if (image === undefined || image === null) {\r\n      return;\r\n    }\r\n    image.classList.toggle(this.clickString);\r\n    // save the state\r\n    // all id begin with either a or r for action or reaction respectively\r\n    const pos = parseInt(image.id.slice(1));\r\n    switch (image.id.charAt(0)) {\r\n      case 'a':\r\n        this.state.classNameListActions[pos] = image.className;\r\n        break;\r\n      case 'r':\r\n        this.state.classNameListReactions[pos] = image.className;\r\n        break;\r\n      default:\r\n        console.error(`${moduleId} handled Image onClicks wrong.`);\r\n    }\r\n\r\n    this.emitUpdate();\r\n  }\r\n\r\n  /**\r\n   * Helper function to make Payload for Handlebars each loop to pass data\r\n   * @param iterator array size\r\n   */\r\n  protected buildHandlebarPayload(iterator: number, imageObj: any, state: string[]) {\r\n    let payload = [];\r\n    for (let index = 0; index < iterator; index++) {\r\n      payload.push(foundry.utils.mergeObject({number: index, cssClass: state[index]}, imageObj));\r\n    }\r\n    return payload;\r\n  }\r\n\r\n  protected _onChangeCountNumber(event: Event) {\r\n    event.preventDefault();\r\n    const input = event.currentTarget as HTMLInputElement;\r\n    const value = parseInt(input.value);\r\n    if (!isNaN(value)) {\r\n      if (value >= 0) {\r\n        switch (input.id) {\r\n          case 'count-action':\r\n            this.state.numOfActions = value;\r\n            break;\r\n          case 'count-reaction':\r\n            this.state.numOfReactions = value;\r\n            break;\r\n          default:\r\n            console.error(`${moduleId} incorrectly handled number of actions!`);\r\n        }\r\n        this.render();\r\n        this.emitUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  protected override _getHeaderButtons(): ApplicationHeaderButton[] {\r\n    const buttons = super._getHeaderButtons();\r\n\r\n    const headerButton: ApplicationHeaderButton = {\r\n      label: 'JOURNAL.ActionShow',\r\n      class: 'share-image',\r\n      icon: 'fas fa-eye',\r\n      onclick: () => this.showPlayerHandler._handleShowPlayers(this.state),\r\n    };\r\n\r\n    buttons.unshift(headerButton);\r\n    return buttons;\r\n  }\r\n\r\n  /**\r\n   * Update internal state based on the size of the arrays\r\n   */\r\n  protected updateState() {\r\n    // case to few state elements\r\n    if (this.state.classNameListActions.length < this.state.numOfActions) {\r\n      const tmp = Array.from(\r\n        {length: this.state.numOfActions - this.state.classNameListActions.length},\r\n        () => 'symbol',\r\n      );\r\n      this.state.classNameListActions = this.state.classNameListActions.concat(tmp);\r\n    }\r\n    // too many elements,we remove the last elements\r\n    else if (this.state.classNameListActions.length > this.state.numOfActions) {\r\n      const cut_value = this.state.classNameListActions.length - this.state.numOfActions;\r\n      this.state.classNameListActions = this.state.classNameListActions.slice(0, cut_value);\r\n    }\r\n\r\n    // other state same cases\r\n\r\n    // case to few state elements\r\n    if (this.state.classNameListReactions.length < this.state.numOfReactions) {\r\n      const tmp = Array.from(\r\n        {length: this.state.numOfReactions - this.state.classNameListReactions.length},\r\n        () => 'symbol',\r\n      );\r\n      this.state.classNameListReactions = this.state.classNameListReactions.concat(tmp);\r\n    }\r\n    // too many elements, we remove the last elements\r\n    else if (this.state.classNameListReactions.length > this.state.numOfReactions) {\r\n      const cut_value = this.state.classNameListReactions.length - this.state.numOfReactions;\r\n      this.state.classNameListReactions = this.state.classNameListReactions.slice(0, cut_value);\r\n    }\r\n  }\r\n\r\n  protected emitUpdate() {\r\n    game.socket?.emit(socketEvent, {\r\n      operation: 'update',\r\n      state: this.state,\r\n      user: game.userId,\r\n    } as EmitData);\r\n  }\r\n\r\n  public setState(newState: DisplayActions2eData) {\r\n    this.state = newState;\r\n  }\r\n\r\n  private _onButtonClickSelectedActors(event: Event) {\r\n    console.log(event);\r\n    canvas.tokens.controlled.forEach((token: TokenDocumentPF2e) => {\r\n      let app = new DisplayTokenActions2e(token.data._id);\r\n      // let app = new DisplayActions2e();\r\n      app.render(true);\r\n    });\r\n  }\r\n}\r\n","import {DisplayActions2e} from './apps/displayActions';\r\nimport {moduleId} from './constants';\r\nimport {EmitData, MyModule} from './types';\r\n\r\nexport function handleShowToAll(data: EmitData) {\r\n  const dialog = checkForApp(data);\r\n  dialog.render(true, {id: `DisplayActions2e${data.user}`} as RenderOptions);\r\n}\r\n\r\nexport function handleShowToSelection(data: EmitData) {\r\n  if (data.userList?.includes(String(game.userId))) {\r\n    const dialog = checkForApp(data);\r\n    dialog.render(true, {id: `DisplayActions2e${data.user}`} as RenderOptions);\r\n  }\r\n}\r\n\r\nexport function handleShowWithPermission(data: EmitData) {\r\n  handleShowToSelection(data);\r\n}\r\n\r\nexport function handleUpdate(data: EmitData) {\r\n  let module = game.modules.get(moduleId) as unknown as MyModule;\r\n  let nameInTitle = game.users?.find(user => {\r\n    return user.data._id === data.state.sentFromUserId;\r\n  })?.data.name;\r\n\r\n  if (nameInTitle) {\r\n    module.displayActions2e.forEach(app => {\r\n      // check for title OR own application update\r\n      // this is why checkForApp cannot be used\r\n      if (app.title.includes(nameInTitle!) || data.state.sentFromUserId === game.userId) {\r\n        app.setState(data.state);\r\n        app.render(false, {id: `DisplayActions2e${data.user}`} as RenderOptions);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * helper function to return the application from the modules or build a new one\r\n * immediatly pushes a new app into the list of modules\r\n * @param data data from emit\r\n * @returns either found DisplayActions2e or new DisplayActions2e with state\r\n */\r\nfunction checkForApp(data: EmitData): DisplayActions2e {\r\n  let module = game.modules.get(moduleId) as unknown as MyModule;\r\n  let nameInTitle = game.users?.find(user => {\r\n    return user.data._id === data.state.sentFromUserId;\r\n  })?.data.name;\r\n  let newApp: DisplayActions2e = new DisplayActions2e(data.state);\r\n\r\n  if (nameInTitle) {\r\n    let app = module.displayActions2e.find(app => {\r\n      return app.title.includes(nameInTitle!);\r\n    });\r\n\r\n    if (app) {\r\n      newApp = app;\r\n    } else {\r\n      // push into list to wait for updates\r\n      module.displayActions2e.push(newApp);\r\n    }\r\n  }\r\n\r\n  return newApp;\r\n}\r\n","// Do not remove this import. If you do Vite will think your styles are dead\r\n// code and not include them in the build output.\r\nimport '../styles/module.css';\r\nimport {DisplayActions2e} from './apps/displayActions';\r\nimport {moduleId, socketEvent} from './constants';\r\nimport {EmitData, MyModule} from './types';\r\nimport './socket';\r\nimport {handleShowToAll, handleShowToSelection, handleShowWithPermission, handleUpdate} from './socket';\r\n\r\nlet module: MyModule;\r\nlet homeDisplayActions: DisplayActions2e;\r\n\r\n// Foundry Hooks\r\nHooks.once('init', () => {\r\n  console.log(`Initializing ${moduleId}`);\r\n});\r\n\r\nHooks.on('getSceneControlButtons', (hudButtons: SceneControl[]) => {\r\n  let hud = hudButtons.find((value: any) => {\r\n    return value.name === 'token';\r\n  });\r\n\r\n  let tool: SceneControlTool = {\r\n    name: 'DisplayActions2e.ButtonName',\r\n    title: 'DisplayActions2e.ButtonHint',\r\n    icon: 'fa fa-angle-double-right',\r\n    button: true,\r\n    visible: true,\r\n    onClick: async () => {\r\n      homeDisplayActions.render(true);\r\n      game.socket?.emit('module.DisplayActions2e', {event: 'DisplayActions2e'});\r\n    },\r\n  };\r\n\r\n  hud?.tools?.push(tool);\r\n});\r\n\r\nHooks.on('ready', () => {\r\n  module = game.modules.get(moduleId) as unknown as MyModule;\r\n  homeDisplayActions = new DisplayActions2e();\r\n  module.displayActions2e = [homeDisplayActions];\r\n  // sockets\r\n  game.socket?.on(socketEvent, (data: EmitData) => {\r\n    // all my events\r\n    switch (data.operation) {\r\n      case 'showToAll':\r\n        handleShowToAll(data);\r\n        break;\r\n      case 'showToSelection':\r\n        handleShowToSelection(data);\r\n        break;\r\n      case 'showWithPermission':\r\n        handleShowWithPermission(data);\r\n        break;\r\n      case 'update':\r\n        handleUpdate(data);\r\n        break;\r\n      default:\r\n        console.log(data);\r\n        break;\r\n    }\r\n  });\r\n});\r\n"],"names":["moduleId","name","socketEvent","DisplayTokenActions2e","DisplayActions2e","tokenId","newState","__publicField","title","token","html","SelectiveShowApp","users","state","options","_a","data","u","ev","selector","element","activeUserId","linked","_b","user","event","image","pos","iterator","imageObj","payload","index","input","value","buttons","headerButton","tmp","cut_value","handleShowToAll","checkForApp","handleShowToSelection","handleShowWithPermission","handleUpdate","module","nameInTitle","app","newApp","homeDisplayActions","hudButtons","hud","tool"],"mappings":"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"}