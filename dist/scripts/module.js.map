{"version":3,"file":"module.js","sources":["../../src/ts/constants.ts","../../src/ts/apps/displayActions.ts","../../src/ts/socket.ts","../../src/ts/module.ts"],"sourcesContent":["import {name} from '../module.json';\r\n\r\nexport const moduleId = name;\r\nexport const moduleName = 'DisplayActions2e';\r\nexport const socketEvent = `module.${moduleId}`;\r\n","import {moduleId, socketEvent} from '../constants';\r\nimport {DisplayActions2eData, EmitData} from '../types';\r\n\r\nexport class DisplayActions2e extends Application {\r\n  private clickString = 'symbolClick';\r\n  private actionImage = '/systems/pf2e/icons/actions/OneAction.webp';\r\n  private reactionImage = '/systems/pf2e/icons/actions/Reaction.webp';\r\n  private numOfActions = 3;\r\n  private numOfReactions = 1;\r\n  private socketlib: any;\r\n\r\n  private state: DisplayActions2eData = {\r\n    numOfActions: this.numOfActions,\r\n    numOfReactions: this.numOfReactions,\r\n    classNameListActions: Array.from({length: this.numOfActions}, () => 'symbol'),\r\n    classNameListReactions: Array.from({length: this.numOfReactions}, () => 'symbol'),\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  override get title(): string {\r\n    return (game as Game).i18n.localize('DisplayActions2e.WindowTitle');\r\n  }\r\n\r\n  static override get defaultOptions(): ApplicationOptions {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'DisplayActions2e',\r\n      template: `modules/${moduleId}/templates/result.hbs`,\r\n      width: 600,\r\n      height: 200,\r\n      resizable: true,\r\n      title: 'DisplayActions2e.WindowTitle',\r\n    }) as ApplicationOptions;\r\n  }\r\n\r\n  override getData() {\r\n    this.updateState();\r\n\r\n    return {\r\n      numOfActions: this.numOfActions,\r\n      numOfReactions: this.numOfReactions,\r\n      actionImagePayload: this.buildHandlebarPayload(\r\n        this.numOfActions,\r\n        {actionImage: this.actionImage},\r\n        this.state.classNameListActions,\r\n      ),\r\n      reactionImagePayload: this.buildHandlebarPayload(\r\n        this.numOfReactions,\r\n        {reactionImage: this.reactionImage},\r\n        this.state.classNameListReactions,\r\n      ),\r\n    };\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>): void {\r\n    super.activateListeners(html);\r\n    html.find('img.symbol').on('click', this._onClickSymbolImage.bind(this));\r\n    html.find('input.input-counter').on('change', this._onChangeCountNumber.bind(this));\r\n  }\r\n\r\n  private _onClickSymbolImage(event: Event) {\r\n    event.preventDefault();\r\n    // switch css classes of the images\r\n    const image = event.currentTarget as HTMLImageElement;\r\n    if (image === undefined || image === null) {\r\n      return;\r\n    }\r\n    if (image.className === undefined || image.className === null) {\r\n      return;\r\n    }\r\n    if (image.className.includes(this.clickString)) {\r\n      image.className = image.className.replace(this.clickString, '');\r\n    } else {\r\n      image.className = image.className.concat(' ', this.clickString);\r\n    }\r\n    // save the state\r\n    // all id begin with either a or r for action or reaction respectively\r\n    const pos = parseInt(image.id.slice(1));\r\n    switch (image.id.charAt(0)) {\r\n      case 'a':\r\n        this.state.classNameListActions[pos] = image.className;\r\n        break;\r\n      case 'r':\r\n        this.state.classNameListReactions[pos] = image.className;\r\n        break;\r\n      default:\r\n        console.error(`${moduleId} handled Image onClicks wrong.`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Helper function to make Payload for Handlebars each loop to pass data\r\n   * @param iterator array size\r\n   */\r\n  private buildHandlebarPayload(iterator: number, imageObj: any, state: string[]) {\r\n    let payload = [];\r\n    for (let index = 0; index < iterator; index++) {\r\n      payload.push(foundry.utils.mergeObject({number: index, cssClass: state[index]}, imageObj));\r\n    }\r\n    return payload;\r\n  }\r\n\r\n  private _onChangeCountNumber(event: Event) {\r\n    event.preventDefault();\r\n    const input = event.currentTarget as HTMLInputElement;\r\n    const value = parseInt(input.value);\r\n    if (!isNaN(value)) {\r\n      if (value >= 0) {\r\n        switch (input.id) {\r\n          case 'count-action':\r\n            this.numOfActions = value;\r\n            break;\r\n          case 'count-reaction':\r\n            this.numOfReactions = value;\r\n            break;\r\n          default:\r\n            console.error(`${moduleId} incorrectly handled number of actions!`);\r\n        }\r\n        this.render();\r\n      }\r\n    }\r\n  }\r\n\r\n  protected override _getHeaderButtons(): Application.HeaderButton[] {\r\n    const buttons = super._getHeaderButtons();\r\n\r\n    const headerButton: Application.HeaderButton = {\r\n      label: 'JOURNAL.ActionShow',\r\n      class: 'share-image',\r\n      icon: 'fas fa-eye',\r\n      onclick: event => this._onShowPlayers(event),\r\n    };\r\n\r\n    buttons.unshift(headerButton);\r\n    return buttons;\r\n  }\r\n\r\n  private _onShowPlayers(event: JQuery.ClickEvent<any, any, any, any>) {\r\n    event.preventDefault();\r\n    (game as Game).socket?.emit(socketEvent, {\r\n      operation: 'showToAll',\r\n      displayApp: this,\r\n      user: (game as Game).userId,\r\n      html: this.render,\r\n    } as EmitData);\r\n    // this.socketlib.executeForEveryone(this.render(), (game as Game).user?.name);\r\n    this.socketlib.executeForEveryone('showToAll', (game as Game).user?.name);\r\n  }\r\n\r\n  setSocketlib(socketlib: any) {\r\n    this.socketlib = socketlib;\r\n  }\r\n\r\n  /**\r\n   * Update internal state based on the size of the arrays\r\n   */\r\n  private updateState() {\r\n    // case to few state elements\r\n    if (this.state.classNameListActions.length < this.numOfActions) {\r\n      const tmp = Array.from({length: this.numOfActions - this.state.classNameListActions.length}, () => 'symbol');\r\n      this.state.classNameListActions = this.state.classNameListActions.concat(tmp);\r\n    }\r\n    // too many elements,we remove the last elements\r\n    else if (this.state.classNameListActions.length > this.numOfActions) {\r\n      const cut_value = this.state.classNameListActions.length - this.numOfActions;\r\n      this.state.classNameListActions = this.state.classNameListActions.slice(0, cut_value);\r\n    }\r\n\r\n    // other state same cases\r\n\r\n    // case to few state elements\r\n    if (this.state.classNameListReactions.length < this.numOfReactions) {\r\n      const tmp = Array.from({length: this.numOfReactions - this.state.classNameListReactions.length}, () => 'symbol');\r\n      this.state.classNameListReactions = this.state.classNameListReactions.concat(tmp);\r\n    }\r\n    // too many elements,we remove the last elements\r\n    else if (this.state.classNameListReactions.length > this.numOfReactions) {\r\n      const cut_value = this.state.classNameListReactions.length - this.numOfReactions;\r\n      this.state.classNameListReactions = this.state.classNameListReactions.slice(0, cut_value);\r\n    }\r\n  }\r\n}\r\n","import {moduleId} from './constants';\r\nimport {EmitData, MyModule} from './types';\r\n\r\nexport function handleShowToAll(data: EmitData) {\r\n  console.log(data);\r\n}\r\n\r\nexport function handleSocketlib() {\r\n  const module = (game as Game).modules.get(moduleId) as MyModule;\r\n  module.displayActions2e.render(true);\r\n}\r\n","// Do not remove this import. If you do Vite will think your styles are dead\r\n// code and not include them in the build output.\r\nimport '../styles/module.css';\r\nimport {DisplayActions2e} from './apps/displayActions';\r\nimport {moduleId, socketEvent} from './constants';\r\nimport {EmitData, MyModule} from './types';\r\nimport './socket';\r\nimport {handleShowToAll, handleSocketlib} from './socket';\r\n\r\nlet module: MyModule;\r\nlet socket: any;\r\n\r\n// Foundry Hooks\r\nHooks.once('init', () => {\r\n  console.log(`Initializing ${moduleId}`);\r\n});\r\n\r\nHooks.on('getSceneControlButtons', hudButtons => {\r\n  let hud = hudButtons.find(value => {\r\n    return value.name === 'token';\r\n  });\r\n\r\n  hud?.tools.push({\r\n    name: 'DisplayActions2e.ButtonName',\r\n    title: 'DisplayActions2e.ButtonHint',\r\n    icon: 'fa fa-angle-double-right',\r\n    button: true,\r\n    onClick: async () => {\r\n      module.displayActions2e.render(true);\r\n      (game as Game).socket?.emit('module.DisplayActions2e', {event: 'DisplayActions2e'});\r\n    },\r\n  });\r\n});\r\n\r\nHooks.once('socketlib.ready', () => {\r\n  // 👇️ ts-ignore ignores any ts errors on the next line\r\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n  // @ts-ignore\r\n  socket = socketlib.registerModule(moduleId);\r\n  console.log(socket);\r\n  console.log('Jens');\r\n});\r\n\r\nHooks.on('ready', () => {\r\n  module = (game as Game).modules.get(moduleId) as MyModule;\r\n  module.displayActions2e = new DisplayActions2e();\r\n\r\n  module.displayActions2e.setSocketlib(socket);\r\n  socket.register('showToAll', handleSocketlib);\r\n\r\n  // sockets\r\n  (game as Game).socket?.on(socketEvent, (data: EmitData) => {\r\n    // all my events\r\n    console.log('Jens');\r\n    switch (data.operation) {\r\n      case 'showToAll':\r\n        handleShowToAll(data);\r\n        break;\r\n      default:\r\n        console.log(data);\r\n        break;\r\n    }\r\n  });\r\n});\r\n"],"names":["moduleId","name","socketEvent","DisplayActions2e","__publicField","html","event","image","pos","iterator","imageObj","state","payload","index","input","value","buttons","headerButton","_a","_b","socketlib","tmp","cut_value","handleShowToAll","data","handleSocketlib","module","socket","hudButtons","hud"],"mappings":"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"}