{"version":3,"file":"module.js","sources":["../../src/ts/constants.ts","../../src/ts/DataWrapper2e.ts","../../src/ts/apps/selectiveShow.ts","../../src/ts/apps/displayActions.ts","../../src/ts/socket.ts","../../src/ts/module.ts"],"sourcesContent":["import {name} from '../module.json';\r\n\r\nexport const moduleId = name;\r\nexport const moduleName = 'DisplayActions2e';\r\nexport const socketEvent = `module.${moduleId}`;\r\n","import {DisplayActions2e} from './apps/displayActions';\r\n\r\nexport class DataWrapper2e {\r\n  /*private conditions = {\r\n    slowed: -1,\r\n  };*/\r\n\r\n  public static getData(): [number, number] {\r\n    let numOfActions = 3;\r\n    let numOfReactions = 1;\r\n\r\n    canvas.tokens.controlled;\r\n\r\n    return [numOfActions, numOfReactions];\r\n  }\r\n\r\n  public static createApplications() {\r\n    let title = game.i18n.localize('DisplayActions2e.WindowTitle');\r\n    canvas.tokens.controlled.forEach((token: any) => {\r\n      let app = new DisplayActions2e(undefined, true);\r\n      title.concat(`for ${token.name}`);\r\n      app.render(true, {id: `DisplayActions2e${game.userId}`, title: title} as RenderOptions);\r\n    });\r\n  }\r\n}\r\n","/* original by FVTT-SelectiveShow */\r\n\r\nimport {moduleId, socketEvent} from '../constants';\r\nimport {DisplayActions2eData, EmitData} from '../types';\r\n\r\nexport class SelectiveShowApp extends FormApplication {\r\n  private userNameList: string[];\r\n  private displayActionState: DisplayActions2eData;\r\n\r\n  constructor(users: string[], state: DisplayActions2eData) {\r\n    super(users);\r\n    this.userNameList = users;\r\n    this.displayActionState = state;\r\n  }\r\n\r\n  static override get defaultOptions() {\r\n    const options = super.defaultOptions;\r\n    options.id = 'DisplayActions2e-selective-show';\r\n    options.template = `modules/${moduleId}/templates/selectiveshow.html`;\r\n    options.classes?.push('selective-show');\r\n    options.height = 300;\r\n    options.width = 250;\r\n    options.minimizable = true;\r\n    options.resizable = true;\r\n    options.title = game.i18n.localize('selectiveshow.SelectiveShow');\r\n    return options;\r\n  }\r\n\r\n  override async getData() {\r\n    let data = await super.getData();\r\n    // üëáÔ∏è ts-ignore ignores any ts errors on the next line\r\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n    // @ts-ignore\r\n    data.users = game.users.filter(u => u.active && u.data.id != game.user.id);\r\n    return data;\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>) {\r\n    super.activateListeners(html);\r\n\r\n    html.find('.show').click(ev => {\r\n      ev.preventDefault();\r\n      this._updateObject();\r\n      // let selector = $(ev.currentTarget).parents('form').find('select');\r\n      game.socket?.emit(socketEvent, {\r\n        operation: 'showToSelection',\r\n        state: this.displayActionState,\r\n        user: game.userId,\r\n        userList: this.userNameList,\r\n      } as EmitData);\r\n      this.close();\r\n    });\r\n    html.find('.show-all').click(ev => {\r\n      ev.preventDefault();\r\n      this._updateObject();\r\n\r\n      game.socket?.emit(socketEvent, {\r\n        operation: 'showToAll',\r\n        state: this.displayActionState,\r\n        user: game.userId,\r\n      } as EmitData);\r\n\r\n      this.close();\r\n    });\r\n\r\n    html.find('.show-permissions').click(ev => {\r\n      ev.preventDefault();\r\n      this._updateObject();\r\n\r\n      this.displayActionState.userListPermissions = this.userNameList;\r\n\r\n      game.socket?.emit(socketEvent, {\r\n        operation: 'showWithPermission',\r\n        state: this.displayActionState,\r\n        user: game.userId,\r\n        userList: this.userNameList,\r\n      } as EmitData);\r\n\r\n      this.close();\r\n    });\r\n  }\r\n\r\n  protected override _updateObject(): Promise<unknown> {\r\n    let selector = Array.from(\r\n      document.getElementsByClassName('selective-show-form')[0].children[0].children[0].children[0].children,\r\n    ) as HTMLOptionElement[];\r\n    this.userNameList = selector.map((element: HTMLOptionElement) => {\r\n      // üëáÔ∏è ts-ignore ignores any ts errors on the next line\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n      // @ts-ignore\r\n      if (element.selected) {\r\n        return element.value;\r\n      }\r\n      return '';\r\n    });\r\n\r\n    // active User Id needs to be send always\r\n    let activeUserId = game.userId;\r\n    if (activeUserId) {\r\n      if (!this.userNameList.includes(activeUserId)) {\r\n        this.userNameList.push(activeUserId);\r\n      }\r\n    }\r\n    return new Promise<unknown>(() => {});\r\n  }\r\n\r\n  _handleShowPlayers(state: DisplayActions2eData) {\r\n    this.render(true);\r\n    this.displayActionState = state;\r\n  }\r\n}\r\n","import {moduleId, socketEvent} from '../constants';\r\nimport {DataWrapper2e} from '../DataWrapper2e';\r\nimport {DisplayActions2eData, EmitData} from '../types';\r\nimport {SelectiveShowApp} from './selectiveShow';\r\n\r\nexport class DisplayActions2e extends Application {\r\n  private clickString = 'symbolClick';\r\n  private actionImage = '/systems/pf2e/icons/actions/OneAction.webp';\r\n  private reactionImage = '/systems/pf2e/icons/actions/Reaction.webp';\r\n  private defaultNumOfActions = 3;\r\n  private defaultNumOfReactions = 1;\r\n  private isLinkedToActor = false;\r\n\r\n  private state: DisplayActions2eData = {\r\n    numOfActions: this.defaultNumOfActions,\r\n    numOfReactions: this.defaultNumOfReactions,\r\n    classNameListActions: Array.from({length: this.defaultNumOfActions}, () => 'symbol'),\r\n    classNameListReactions: Array.from({length: this.defaultNumOfReactions}, () => 'symbol'),\r\n    sentFromUserId: String(game.userId),\r\n    userListPermissions: [String(game.userId)],\r\n  };\r\n\r\n  private showPlayerHandler: SelectiveShowApp = new SelectiveShowApp([String(game.user?.data.name)], this.state);\r\n\r\n  constructor(newState?: DisplayActions2eData, linked = false) {\r\n    super();\r\n    this.isLinkedToActor = linked;\r\n\r\n    if (newState) {\r\n      this.state = newState;\r\n    }\r\n  }\r\n\r\n  override get title(): string {\r\n    let title = game.i18n.localize('DisplayActions2e.WindowTitle');\r\n    if (this.state.sentFromUserId === game.userId) {\r\n      return title;\r\n    }\r\n\r\n    let name = game.users?.find(user => {\r\n      return user.data._id === this.state.sentFromUserId;\r\n    })?.data.name;\r\n\r\n    return title.concat(' sent from ', String(name));\r\n  }\r\n\r\n  static override get defaultOptions(): ApplicationOptions {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'DisplayActions2e',\r\n      template: `modules/${moduleId}/templates/result.hbs`,\r\n      width: 600,\r\n      height: 200,\r\n      resizable: true,\r\n      title: 'DisplayActions2e.WindowTitle',\r\n    }) as ApplicationOptions;\r\n  }\r\n\r\n  override getData() {\r\n    this.updateState();\r\n\r\n    return {\r\n      numOfActions: this.state.numOfActions,\r\n      numOfReactions: this.state.numOfReactions,\r\n      actionImagePayload: this.buildHandlebarPayload(\r\n        this.state.numOfActions,\r\n        {actionImage: this.actionImage},\r\n        this.state.classNameListActions,\r\n      ),\r\n      reactionImagePayload: this.buildHandlebarPayload(\r\n        this.state.numOfReactions,\r\n        {reactionImage: this.reactionImage},\r\n        this.state.classNameListReactions,\r\n      ),\r\n      isLinkedToActor: this.isLinkedToActor,\r\n    };\r\n  }\r\n\r\n  override activateListeners(html: JQuery<HTMLElement>): void {\r\n    super.activateListeners(html);\r\n    // register events for all users with permission\r\n    if (this.state.userListPermissions.includes(String(game.userId))) {\r\n      html.find('img.symbol').on('click', this._onClickSymbolImage.bind(this));\r\n      html.find('input.input-counter').on('change', this._onChangeCountNumber.bind(this));\r\n      html.find('button.actorLink').on('click', DataWrapper2e.createApplications.bind(DataWrapper2e));\r\n    }\r\n  }\r\n\r\n  private _onClickSymbolImage(event: Event) {\r\n    event.preventDefault();\r\n    // switch css classes of the images\r\n    const image = event.currentTarget as HTMLImageElement;\r\n    if (image === undefined || image === null) {\r\n      return;\r\n    }\r\n    image.classList.toggle(this.clickString);\r\n    // save the state\r\n    // all id begin with either a or r for action or reaction respectively\r\n    const pos = parseInt(image.id.slice(1));\r\n    switch (image.id.charAt(0)) {\r\n      case 'a':\r\n        this.state.classNameListActions[pos] = image.className;\r\n        break;\r\n      case 'r':\r\n        this.state.classNameListReactions[pos] = image.className;\r\n        break;\r\n      default:\r\n        console.error(`${moduleId} handled Image onClicks wrong.`);\r\n    }\r\n\r\n    this.emitUpdate();\r\n  }\r\n\r\n  /**\r\n   * Helper function to make Payload for Handlebars each loop to pass data\r\n   * @param iterator array size\r\n   */\r\n  private buildHandlebarPayload(iterator: number, imageObj: any, state: string[]) {\r\n    let payload = [];\r\n    for (let index = 0; index < iterator; index++) {\r\n      payload.push(foundry.utils.mergeObject({number: index, cssClass: state[index]}, imageObj));\r\n    }\r\n    return payload;\r\n  }\r\n\r\n  private _onChangeCountNumber(event: Event) {\r\n    event.preventDefault();\r\n    const input = event.currentTarget as HTMLInputElement;\r\n    const value = parseInt(input.value);\r\n    if (!isNaN(value)) {\r\n      if (value >= 0) {\r\n        switch (input.id) {\r\n          case 'count-action':\r\n            this.state.numOfActions = value;\r\n            break;\r\n          case 'count-reaction':\r\n            this.state.numOfReactions = value;\r\n            break;\r\n          default:\r\n            console.error(`${moduleId} incorrectly handled number of actions!`);\r\n        }\r\n        this.render();\r\n        this.emitUpdate();\r\n      }\r\n    }\r\n  }\r\n\r\n  protected override _getHeaderButtons(): ApplicationHeaderButton[] {\r\n    const buttons = super._getHeaderButtons();\r\n\r\n    const headerButton: ApplicationHeaderButton = {\r\n      label: 'JOURNAL.ActionShow',\r\n      class: 'share-image',\r\n      icon: 'fas fa-eye',\r\n      onclick: () => this.showPlayerHandler._handleShowPlayers(this.state),\r\n    };\r\n\r\n    buttons.unshift(headerButton);\r\n    return buttons;\r\n  }\r\n\r\n  /**\r\n   * Update internal state based on the size of the arrays\r\n   */\r\n  private updateState() {\r\n    // case to few state elements\r\n    if (this.state.classNameListActions.length < this.state.numOfActions) {\r\n      const tmp = Array.from(\r\n        {length: this.state.numOfActions - this.state.classNameListActions.length},\r\n        () => 'symbol',\r\n      );\r\n      this.state.classNameListActions = this.state.classNameListActions.concat(tmp);\r\n    }\r\n    // too many elements,we remove the last elements\r\n    else if (this.state.classNameListActions.length > this.state.numOfActions) {\r\n      const cut_value = this.state.classNameListActions.length - this.state.numOfActions;\r\n      this.state.classNameListActions = this.state.classNameListActions.slice(0, cut_value);\r\n    }\r\n\r\n    // other state same cases\r\n\r\n    // case to few state elements\r\n    if (this.state.classNameListReactions.length < this.state.numOfReactions) {\r\n      const tmp = Array.from(\r\n        {length: this.state.numOfReactions - this.state.classNameListReactions.length},\r\n        () => 'symbol',\r\n      );\r\n      this.state.classNameListReactions = this.state.classNameListReactions.concat(tmp);\r\n    }\r\n    // too many elements, we remove the last elements\r\n    else if (this.state.classNameListReactions.length > this.state.numOfReactions) {\r\n      const cut_value = this.state.classNameListReactions.length - this.state.numOfReactions;\r\n      this.state.classNameListReactions = this.state.classNameListReactions.slice(0, cut_value);\r\n    }\r\n  }\r\n\r\n  private emitUpdate() {\r\n    game.socket?.emit(socketEvent, {\r\n      operation: 'update',\r\n      state: this.state,\r\n      user: game.userId,\r\n    } as EmitData);\r\n  }\r\n\r\n  public setState(newState: DisplayActions2eData) {\r\n    this.state = newState;\r\n  }\r\n}\r\n","import {DisplayActions2e} from './apps/displayActions';\r\nimport {moduleId} from './constants';\r\nimport {EmitData, MyModule} from './types';\r\n\r\nexport function handleShowToAll(data: EmitData) {\r\n  const dialog = checkForApp(data);\r\n  dialog.render(true, {id: `DisplayActions2e${data.user}`} as RenderOptions);\r\n}\r\n\r\nexport function handleShowToSelection(data: EmitData) {\r\n  if (data.userList?.includes(String(game.userId))) {\r\n    const dialog = checkForApp(data);\r\n    dialog.render(true, {id: `DisplayActions2e${data.user}`} as RenderOptions);\r\n  }\r\n}\r\n\r\nexport function handleShowWithPermission(data: EmitData) {\r\n  handleShowToSelection(data);\r\n}\r\n\r\nexport function handleUpdate(data: EmitData) {\r\n  let module = game.modules.get(moduleId) as unknown as MyModule;\r\n  let nameInTitle = game.users?.find(user => {\r\n    return user.data._id === data.state.sentFromUserId;\r\n  })?.data.name;\r\n\r\n  if (nameInTitle) {\r\n    module.displayActions2e.forEach(app => {\r\n      // check for title OR own application update\r\n      // this is why checkForApp cannot be used\r\n      if (app.title.includes(nameInTitle!) || data.state.sentFromUserId === game.userId) {\r\n        app.setState(data.state);\r\n        app.render(false, {id: `DisplayActions2e${data.user}`} as RenderOptions);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * helper function to return the application from the modules or build a new one\r\n * immediatly pushes a new app into the list of modules\r\n * @param data data from emit\r\n * @returns either found DisplayActions2e or new DisplayActions2e with state\r\n */\r\nfunction checkForApp(data: EmitData): DisplayActions2e {\r\n  let module = game.modules.get(moduleId) as unknown as MyModule;\r\n  let nameInTitle = game.users?.find(user => {\r\n    return user.data._id === data.state.sentFromUserId;\r\n  })?.data.name;\r\n  let newApp: DisplayActions2e = new DisplayActions2e(data.state);\r\n\r\n  if (nameInTitle) {\r\n    let app = module.displayActions2e.find(app => {\r\n      return app.title.includes(nameInTitle!);\r\n    });\r\n\r\n    if (app) {\r\n      newApp = app;\r\n    } else {\r\n      // push into list to wait for updates\r\n      module.displayActions2e.push(newApp);\r\n    }\r\n  }\r\n\r\n  return newApp;\r\n}\r\n","// Do not remove this import. If you do Vite will think your styles are dead\r\n// code and not include them in the build output.\r\nimport '../styles/module.css';\r\nimport {DisplayActions2e} from './apps/displayActions';\r\nimport {moduleId, socketEvent} from './constants';\r\nimport {EmitData, MyModule} from './types';\r\nimport './socket';\r\nimport {handleShowToAll, handleShowToSelection, handleShowWithPermission, handleUpdate} from './socket';\r\nimport {DataWrapper2e} from './DataWrapper2e';\r\n\r\nlet module: MyModule;\r\nlet homeDisplayActions: DisplayActions2e;\r\n\r\n// Foundry Hooks\r\nHooks.once('init', () => {\r\n  console.log(`Initializing ${moduleId}`);\r\n});\r\n\r\nHooks.on('getSceneControlButtons', hudButtons => {\r\n  let hud = hudButtons.find((value: any) => {\r\n    return value.name === 'token';\r\n  });\r\n\r\n  hud?.tools.push({\r\n    name: 'DisplayActions2e.ButtonName',\r\n    title: 'DisplayActions2e.ButtonHint',\r\n    icon: 'fa fa-angle-double-right',\r\n    button: true,\r\n    onClick: async () => {\r\n      homeDisplayActions.render(true);\r\n      game.socket?.emit('module.DisplayActions2e', {event: 'DisplayActions2e'});\r\n    },\r\n  });\r\n});\r\n\r\nHooks.on('ready', () => {\r\n  module = game.modules.get(moduleId) as unknown as MyModule;\r\n  homeDisplayActions = new DisplayActions2e();\r\n  module.displayActions2e = [homeDisplayActions];\r\n  // sockets\r\n  game.socket?.on(socketEvent, (data: EmitData) => {\r\n    // all my events\r\n    switch (data.operation) {\r\n      case 'showToAll':\r\n        handleShowToAll(data);\r\n        break;\r\n      case 'showToSelection':\r\n        handleShowToSelection(data);\r\n        break;\r\n      case 'showWithPermission':\r\n        handleShowWithPermission(data);\r\n        break;\r\n      case 'update':\r\n        handleUpdate(data);\r\n        break;\r\n      default:\r\n        console.log(data);\r\n        break;\r\n    }\r\n  });\r\n  DataWrapper2e.getData();\r\n});\r\n"],"names":["moduleId","name","socketEvent","DataWrapper2e","numOfActions","numOfReactions","title","token","app","DisplayActions2e","SelectiveShowApp","users","state","__publicField","options","_a","data","u","html","ev","selector","element","activeUserId","newState","linked","_b","user","event","image","pos","iterator","imageObj","payload","index","input","value","buttons","headerButton","tmp","cut_value","handleShowToAll","checkForApp","handleShowToSelection","handleShowWithPermission","handleUpdate","module","nameInTitle","newApp","homeDisplayActions","hudButtons","hud"],"mappings":"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"}