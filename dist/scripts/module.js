var g=Object.defineProperty;var f=(i,s,t)=>s in i?g(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var n=(i,s,t)=>(f(i,typeof s!="symbol"?s+"":s,t),t);const p="pf2e-display-actions",o=p,l=`module.${o}`;class A extends FormApplication{constructor(t,e){super(t);n(this,"userNameList");n(this,"displayActionState");this.userNameList=t,this.displayActionState=e}static get defaultOptions(){const t=super.defaultOptions;return t.id="DisplayActions2e-selective-show",t.template=`modules/${o}/templates/selectiveshow.html`,t.classes.push("selective-show"),t.height=300,t.width=250,t.minimizable=!0,t.resizable=!0,t.title=game.i18n.localize("selectiveshow.SelectiveShow"),t}async getData(){let t=await super.getData();return t.users=game.users.filter(e=>e.active&&e.data.id!=game.user.id),t}activateListeners(t){super.activateListeners(t),t.find(".show").click(e=>{var a;e.preventDefault(),this._updateObject(),(a=game.socket)==null||a.emit(l,{operation:"showToSelection",state:this.displayActionState,user:game.userId,userList:this.userNameList}),this.close()}),t.find(".show-all").click(e=>{var a;e.preventDefault(),this._updateObject(),(a=game.socket)==null||a.emit(l,{operation:"showToAll",state:this.displayActionState,user:game.userId}),this.close()})}_updateObject(){let t=Array.from(document.getElementsByClassName("selective-show-form")[0].children[0].children[0].children[0].children);return this.userNameList=t.map(e=>e.selected?e.value:""),console.log(this.userNameList),new Promise(()=>{console.log("In the Promise")})}_handleShowPlayers(t){this.render(!0),this.displayActionState=t,console.log(this.displayActionState),console.log(this.userNameList)}}var h,d;class u extends Application{constructor(t){super();n(this,"clickString","symbolClick");n(this,"actionImage","/systems/pf2e/icons/actions/OneAction.webp");n(this,"reactionImage","/systems/pf2e/icons/actions/Reaction.webp");n(this,"defaultNumOfActions",3);n(this,"defaultNumOfReactions",1);n(this,"state",{numOfActions:this.defaultNumOfActions,numOfReactions:this.defaultNumOfReactions,classNameListActions:Array.from({length:this.defaultNumOfActions},()=>"symbol"),classNameListReactions:Array.from({length:this.defaultNumOfReactions},()=>"symbol"),sentFromName:String((h=game.user)==null?void 0:h.name)});n(this,"showPlayerHandler",new A([String((d=game.user)==null?void 0:d.name)],this.state));t&&(this.state=t)}get title(){var e;let t=game.i18n.localize("DisplayActions2e.WindowTitle");return this.state.sentFromName===((e=game.user)==null?void 0:e.name)?t:t.concat(" sent from ",this.state.sentFromName)}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"DisplayActions2e",template:`modules/${o}/templates/result.hbs`,width:600,height:200,resizable:!0,title:"DisplayActions2e.WindowTitle"})}getData(){return this.updateState(),{numOfActions:this.state.numOfActions,numOfReactions:this.state.numOfReactions,actionImagePayload:this.buildHandlebarPayload(this.state.numOfActions,{actionImage:this.actionImage},this.state.classNameListActions),reactionImagePayload:this.buildHandlebarPayload(this.state.numOfReactions,{reactionImage:this.reactionImage},this.state.classNameListReactions)}}activateListeners(t){var e;super.activateListeners(t),String((e=game.user)==null?void 0:e.name)===this.state.sentFromName&&(t.find("img.symbol").on("click",this._onClickSymbolImage.bind(this)),t.find("input.input-counter").on("change",this._onChangeCountNumber.bind(this)))}_onClickSymbolImage(t){t.preventDefault();const e=t.currentTarget;if(e==null||e.className===void 0||e.className===null)return;e.className.includes(this.clickString)?e.className=e.className.replace(this.clickString,""):e.className=e.className.concat(" ",this.clickString);const a=parseInt(e.id.slice(1));switch(e.id.charAt(0)){case"a":this.state.classNameListActions[a]=e.className;break;case"r":this.state.classNameListReactions[a]=e.className;break;default:console.error(`${o} handled Image onClicks wrong.`)}}buildHandlebarPayload(t,e,a){let m=[];for(let c=0;c<t;c++)m.push(foundry.utils.mergeObject({number:c,cssClass:a[c]},e));return m}_onChangeCountNumber(t){t.preventDefault();const e=t.currentTarget,a=parseInt(e.value);if(!isNaN(a)&&a>=0){switch(e.id){case"count-action":this.state.numOfActions=a;break;case"count-reaction":this.state.numOfReactions=a;break;default:console.error(`${o} incorrectly handled number of actions!`)}this.render()}}_getHeaderButtons(){const t=super._getHeaderButtons(),e={label:"JOURNAL.ActionShow",class:"share-image",icon:"fas fa-eye",onclick:()=>this.showPlayerHandler._handleShowPlayers(this.state)};return t.unshift(e),t}updateState(){if(this.state.classNameListActions.length<this.state.numOfActions){const t=Array.from({length:this.state.numOfActions-this.state.classNameListActions.length},()=>"symbol");this.state.classNameListActions=this.state.classNameListActions.concat(t)}else if(this.state.classNameListActions.length>this.state.numOfActions){const t=this.state.classNameListActions.length-this.state.numOfActions;this.state.classNameListActions=this.state.classNameListActions.slice(0,t)}if(this.state.classNameListReactions.length<this.state.numOfReactions){const t=Array.from({length:this.state.numOfReactions-this.state.classNameListReactions.length},()=>"symbol");this.state.classNameListReactions=this.state.classNameListReactions.concat(t)}else if(this.state.classNameListReactions.length>this.state.numOfReactions){const t=this.state.classNameListReactions.length-this.state.numOfReactions;this.state.classNameListReactions=this.state.classNameListReactions.slice(0,t)}}}function N(i){new u(i.state).render(!0,{id:`DisplayActions2e${i.user}`})}function y(i){var s;(s=i.userList)!=null&&s.includes(String(game.userId))&&new u(i.state).render(!0,{id:`DisplayActions2e${i.user}`})}let r;Hooks.once("init",()=>{console.log(`Initializing ${o}`)});Hooks.on("getSceneControlButtons",i=>{let s=i.find(t=>t.name==="token");s==null||s.tools.push({name:"DisplayActions2e.ButtonName",title:"DisplayActions2e.ButtonHint",icon:"fa fa-angle-double-right",button:!0,onClick:async()=>{var t;r.displayActions2e.render(!0),(t=game.socket)==null||t.emit("module.DisplayActions2e",{event:"DisplayActions2e"})}})});Hooks.on("ready",()=>{var i;r=game.modules.get(o),r.displayActions2e=new u,(i=game.socket)==null||i.on(l,s=>{switch(s.operation){case"showToAll":N(s);break;case"showToSelection":y(s);default:console.log(s);break}})});
//# sourceMappingURL=module.js.map
