var y=Object.defineProperty;var b=(i,s,t)=>s in i?y(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var c=(i,s,t)=>(b(i,typeof s!="symbol"?s+"":s,t),t);const L="pf2e-display-actions",l=L,r=`module.${l}`;class u{static getData(){let s=3,t=1;return canvas.tokens.controlled,[s,t]}static createApplications(){let s=game.i18n.localize("DisplayActions2e.WindowTitle");canvas.tokens.controlled.forEach(t=>{let e=new d(void 0,!0);s.concat(`for ${t.name}`),e.render(!0,{id:`DisplayActions2e${game.userId}`,title:s})})}}class N extends FormApplication{constructor(t,e){super(t);c(this,"userNameList");c(this,"displayActionState");this.userNameList=t,this.displayActionState=e}static get defaultOptions(){var e;const t=super.defaultOptions;return t.id="DisplayActions2e-selective-show",t.template=`modules/${l}/templates/selectiveshow.html`,(e=t.classes)==null||e.push("selective-show"),t.height=300,t.width=250,t.minimizable=!0,t.resizable=!0,t.title=game.i18n.localize("selectiveshow.SelectiveShow"),t}async getData(){let t=await super.getData();return t.users=game.users.filter(e=>e.active&&e.data.id!=game.user.id),t}activateListeners(t){super.activateListeners(t),t.find(".show").click(e=>{var a;e.preventDefault(),this._updateObject(),(a=game.socket)==null||a.emit(r,{operation:"showToSelection",state:this.displayActionState,user:game.userId,userList:this.userNameList}),this.close()}),t.find(".show-all").click(e=>{var a;e.preventDefault(),this._updateObject(),(a=game.socket)==null||a.emit(r,{operation:"showToAll",state:this.displayActionState,user:game.userId}),this.close()}),t.find(".show-permissions").click(e=>{var a;e.preventDefault(),this._updateObject(),this.displayActionState.userListPermissions=this.userNameList,(a=game.socket)==null||a.emit(r,{operation:"showWithPermission",state:this.displayActionState,user:game.userId,userList:this.userNameList}),this.close()})}_updateObject(){let t=Array.from(document.getElementsByClassName("selective-show-form")[0].children[0].children[0].children[0].children);this.userNameList=t.map(a=>a.selected?a.value:"");let e=game.userId;return e&&(this.userNameList.includes(e)||this.userNameList.push(e)),new Promise(()=>{})}_handleShowPlayers(t){this.render(!0),this.displayActionState=t}}var f;class d extends Application{constructor(t,e=!1){super();c(this,"clickString","symbolClick");c(this,"actionImage","/systems/pf2e/icons/actions/OneAction.webp");c(this,"reactionImage","/systems/pf2e/icons/actions/Reaction.webp");c(this,"defaultNumOfActions",3);c(this,"defaultNumOfReactions",1);c(this,"isLinkedToActor",!1);c(this,"state",{numOfActions:this.defaultNumOfActions,numOfReactions:this.defaultNumOfReactions,classNameListActions:Array.from({length:this.defaultNumOfActions},()=>"symbol"),classNameListReactions:Array.from({length:this.defaultNumOfReactions},()=>"symbol"),sentFromUserId:String(game.userId),userListPermissions:[String(game.userId)]});c(this,"showPlayerHandler",new N([String((f=game.user)==null?void 0:f.data.name)],this.state));this.isLinkedToActor=e,t&&(this.state=t)}get title(){var a,n;let t=game.i18n.localize("DisplayActions2e.WindowTitle");if(this.state.sentFromUserId===game.userId)return t;let e=(n=(a=game.users)==null?void 0:a.find(o=>o.data._id===this.state.sentFromUserId))==null?void 0:n.data.name;return t.concat(" sent from ",String(e))}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"DisplayActions2e",template:`modules/${l}/templates/result.hbs`,width:600,height:200,resizable:!0,title:"DisplayActions2e.WindowTitle"})}getData(){return this.updateState(),{numOfActions:this.state.numOfActions,numOfReactions:this.state.numOfReactions,actionImagePayload:this.buildHandlebarPayload(this.state.numOfActions,{actionImage:this.actionImage},this.state.classNameListActions),reactionImagePayload:this.buildHandlebarPayload(this.state.numOfReactions,{reactionImage:this.reactionImage},this.state.classNameListReactions),isLinkedToActor:this.isLinkedToActor}}activateListeners(t){super.activateListeners(t),this.state.userListPermissions.includes(String(game.userId))&&(t.find("img.symbol").on("click",this._onClickSymbolImage.bind(this)),t.find("input.input-counter").on("change",this._onChangeCountNumber.bind(this)),t.find("button.actorLink").on("click",u.createApplications.bind(u)))}_onClickSymbolImage(t){t.preventDefault();const e=t.currentTarget;if(e==null)return;e.classList.toggle(this.clickString);const a=parseInt(e.id.slice(1));switch(e.id.charAt(0)){case"a":this.state.classNameListActions[a]=e.className;break;case"r":this.state.classNameListReactions[a]=e.className;break;default:console.error(`${l} handled Image onClicks wrong.`)}this.emitUpdate()}buildHandlebarPayload(t,e,a){let n=[];for(let o=0;o<t;o++)n.push(foundry.utils.mergeObject({number:o,cssClass:a[o]},e));return n}_onChangeCountNumber(t){t.preventDefault();const e=t.currentTarget,a=parseInt(e.value);if(!isNaN(a)&&a>=0){switch(e.id){case"count-action":this.state.numOfActions=a;break;case"count-reaction":this.state.numOfReactions=a;break;default:console.error(`${l} incorrectly handled number of actions!`)}this.render(),this.emitUpdate()}}_getHeaderButtons(){const t=super._getHeaderButtons(),e={label:"JOURNAL.ActionShow",class:"share-image",icon:"fas fa-eye",onclick:()=>this.showPlayerHandler._handleShowPlayers(this.state)};return t.unshift(e),t}updateState(){if(this.state.classNameListActions.length<this.state.numOfActions){const t=Array.from({length:this.state.numOfActions-this.state.classNameListActions.length},()=>"symbol");this.state.classNameListActions=this.state.classNameListActions.concat(t)}else if(this.state.classNameListActions.length>this.state.numOfActions){const t=this.state.classNameListActions.length-this.state.numOfActions;this.state.classNameListActions=this.state.classNameListActions.slice(0,t)}if(this.state.classNameListReactions.length<this.state.numOfReactions){const t=Array.from({length:this.state.numOfReactions-this.state.classNameListReactions.length},()=>"symbol");this.state.classNameListReactions=this.state.classNameListReactions.concat(t)}else if(this.state.classNameListReactions.length>this.state.numOfReactions){const t=this.state.classNameListReactions.length-this.state.numOfReactions;this.state.classNameListReactions=this.state.classNameListReactions.slice(0,t)}}emitUpdate(){var t;(t=game.socket)==null||t.emit(r,{operation:"update",state:this.state,user:game.userId})}setState(t){this.state=t}}function k(i){g(i).render(!0,{id:`DisplayActions2e${i.user}`})}function p(i){var s;(s=i.userList)!=null&&s.includes(String(game.userId))&&g(i).render(!0,{id:`DisplayActions2e${i.user}`})}function w(i){p(i)}function O(i){var e,a;let s=game.modules.get(l),t=(a=(e=game.users)==null?void 0:e.find(n=>n.data._id===i.state.sentFromUserId))==null?void 0:a.data.name;t&&s.displayActions2e.forEach(n=>{(n.title.includes(t)||i.state.sentFromUserId===game.userId)&&(n.setState(i.state),n.render(!1,{id:`DisplayActions2e${i.user}`}))})}function g(i){var a,n;let s=game.modules.get(l),t=(n=(a=game.users)==null?void 0:a.find(o=>o.data._id===i.state.sentFromUserId))==null?void 0:n.data.name,e=new d(i.state);if(t){let o=s.displayActions2e.find(A=>A.title.includes(t));o?e=o:s.displayActions2e.push(e)}return e}let h,m;Hooks.once("init",()=>{console.log(`Initializing ${l}`)});Hooks.on("getSceneControlButtons",i=>{let s=i.find(t=>t.name==="token");s==null||s.tools.push({name:"DisplayActions2e.ButtonName",title:"DisplayActions2e.ButtonHint",icon:"fa fa-angle-double-right",button:!0,onClick:async()=>{var t;m.render(!0),(t=game.socket)==null||t.emit("module.DisplayActions2e",{event:"DisplayActions2e"})}})});Hooks.on("ready",()=>{var i;h=game.modules.get(l),m=new d,h.displayActions2e=[m],(i=game.socket)==null||i.on(r,s=>{switch(s.operation){case"showToAll":k(s);break;case"showToSelection":p(s);break;case"showWithPermission":w(s);break;case"update":O(s);break;default:console.log(s);break}}),u.getData()});
//# sourceMappingURL=module.js.map
