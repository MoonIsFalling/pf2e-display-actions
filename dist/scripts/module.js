var A=Object.defineProperty;var y=(s,a,e)=>a in s?A(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e;var c=(s,a,e)=>(y(s,typeof a!="symbol"?a+"":a,e),e);const N="pf2e-display-actions",l=N,r=`module.${l}`;class b extends FormApplication{constructor(e,t){super(e);c(this,"userNameList");c(this,"displayActionState");this.userNameList=e,this.displayActionState=t}static get defaultOptions(){const e=super.defaultOptions;return e.id="DisplayActions2e-selective-show",e.template=`modules/${l}/templates/selectiveshow.html`,e.classes.push("selective-show"),e.height=300,e.width=250,e.minimizable=!0,e.resizable=!0,e.title=game.i18n.localize("selectiveshow.SelectiveShow"),e}async getData(){let e=await super.getData();return e.users=game.users.filter(t=>t.active&&t.data.id!=game.user.id),e}activateListeners(e){super.activateListeners(e),e.find(".show").click(t=>{var i;t.preventDefault(),this._updateObject(),(i=game.socket)==null||i.emit(r,{operation:"showToSelection",state:this.displayActionState,user:game.userId,userList:this.userNameList}),this.close()}),e.find(".show-all").click(t=>{var i;t.preventDefault(),this._updateObject(),(i=game.socket)==null||i.emit(r,{operation:"showToAll",state:this.displayActionState,user:game.userId}),this.close()}),e.find(".show-permissions").click(t=>{var i;t.preventDefault(),this._updateObject(),this.displayActionState.userListPermissions=this.userNameList,(i=game.socket)==null||i.emit(r,{operation:"showWithPermission",state:this.displayActionState,user:game.userId,userList:this.userNameList}),this.close()})}_updateObject(){let e=Array.from(document.getElementsByClassName("selective-show-form")[0].children[0].children[0].children[0].children);this.userNameList=e.map(i=>i.selected?i.value:"");let t=game.userId;return t&&(this.userNameList.includes(t)||this.userNameList.push(t)),console.log(this.userNameList),new Promise(()=>{console.log("In the Promise")})}_handleShowPlayers(e){this.render(!0),this.displayActionState=e,console.log(this.displayActionState),console.log(this.userNameList)}}var h;class d extends Application{constructor(e){super();c(this,"clickString","symbolClick");c(this,"actionImage","/systems/pf2e/icons/actions/OneAction.webp");c(this,"reactionImage","/systems/pf2e/icons/actions/Reaction.webp");c(this,"defaultNumOfActions",3);c(this,"defaultNumOfReactions",1);c(this,"state",{numOfActions:this.defaultNumOfActions,numOfReactions:this.defaultNumOfReactions,classNameListActions:Array.from({length:this.defaultNumOfActions},()=>"symbol"),classNameListReactions:Array.from({length:this.defaultNumOfReactions},()=>"symbol"),sentFromUserId:String(game.userId),userListPermissions:[String(game.userId)]});c(this,"showPlayerHandler",new b([String((h=game.user)==null?void 0:h.name)],this.state));e&&(this.state=e)}get title(){var i,n;let e=game.i18n.localize("DisplayActions2e.WindowTitle");if(this.state.sentFromUserId===game.userId)return e;let t=(n=(i=game.users)==null?void 0:i.find(o=>o.id===this.state.sentFromUserId))==null?void 0:n.name;return e.concat(" sent from ",String(t))}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"DisplayActions2e",template:`modules/${l}/templates/result.hbs`,width:600,height:200,resizable:!0,title:"DisplayActions2e.WindowTitle"})}getData(){return this.updateState(),{numOfActions:this.state.numOfActions,numOfReactions:this.state.numOfReactions,actionImagePayload:this.buildHandlebarPayload(this.state.numOfActions,{actionImage:this.actionImage},this.state.classNameListActions),reactionImagePayload:this.buildHandlebarPayload(this.state.numOfReactions,{reactionImage:this.reactionImage},this.state.classNameListReactions)}}activateListeners(e){super.activateListeners(e),this.state.userListPermissions.includes(String(game.userId))&&(e.find("img.symbol").on("click",this._onClickSymbolImage.bind(this)),e.find("input.input-counter").on("change",this._onChangeCountNumber.bind(this)))}_onClickSymbolImage(e){e.preventDefault();const t=e.currentTarget;if(t==null||t.className===void 0||t.className===null)return;t.className.includes(this.clickString)?t.className=t.className.replace(this.clickString,""):t.className=t.className.concat(" ",this.clickString);const i=parseInt(t.id.slice(1));switch(t.id.charAt(0)){case"a":this.state.classNameListActions[i]=t.className;break;case"r":this.state.classNameListReactions[i]=t.className;break;default:console.error(`${l} handled Image onClicks wrong.`)}this.emitUpdate()}buildHandlebarPayload(e,t,i){let n=[];for(let o=0;o<e;o++)n.push(foundry.utils.mergeObject({number:o,cssClass:i[o]},t));return n}_onChangeCountNumber(e){e.preventDefault();const t=e.currentTarget,i=parseInt(t.value);if(!isNaN(i)&&i>=0){switch(t.id){case"count-action":this.state.numOfActions=i;break;case"count-reaction":this.state.numOfReactions=i;break;default:console.error(`${l} incorrectly handled number of actions!`)}this.render(),this.emitUpdate()}}_getHeaderButtons(){const e=super._getHeaderButtons(),t={label:"JOURNAL.ActionShow",class:"share-image",icon:"fas fa-eye",onclick:()=>this.showPlayerHandler._handleShowPlayers(this.state)};return e.unshift(t),e}updateState(){if(this.state.classNameListActions.length<this.state.numOfActions){const e=Array.from({length:this.state.numOfActions-this.state.classNameListActions.length},()=>"symbol");this.state.classNameListActions=this.state.classNameListActions.concat(e)}else if(this.state.classNameListActions.length>this.state.numOfActions){const e=this.state.classNameListActions.length-this.state.numOfActions;this.state.classNameListActions=this.state.classNameListActions.slice(0,e)}if(this.state.classNameListReactions.length<this.state.numOfReactions){const e=Array.from({length:this.state.numOfReactions-this.state.classNameListReactions.length},()=>"symbol");this.state.classNameListReactions=this.state.classNameListReactions.concat(e)}else if(this.state.classNameListReactions.length>this.state.numOfReactions){const e=this.state.classNameListReactions.length-this.state.numOfReactions;this.state.classNameListReactions=this.state.classNameListReactions.slice(0,e)}}emitUpdate(){var e;console.log("emit Hans"),(e=game.socket)==null||e.emit(r,{operation:"update",state:this.state,user:game.userId})}setState(e){this.state=e}}function L(s){f(s).render(!0,{id:`DisplayActions2e${s.user}`})}function g(s){var a;(a=s.userList)!=null&&a.includes(String(game.userId))&&f(s).render(!0,{id:`DisplayActions2e${s.user}`})}function w(s){g(s)}function S(s){var t,i;let a=game.modules.get(l),e=(i=(t=game.users)==null?void 0:t.find(n=>n.id===s.state.sentFromUserId))==null?void 0:i.name;e&&a.displayActions2e.forEach(n=>{(n.title.includes(e)||s.state.sentFromUserId===game.userId)&&(console.log(`Receive ${e}`),console.log(n),console.log(s),n.setState(s.state),n.render(!1,{id:`DisplayActions2e${s.user}`}))})}function f(s){var i,n;let a=game.modules.get(l),e=(n=(i=game.users)==null?void 0:i.find(o=>o.id===s.state.sentFromUserId))==null?void 0:n.name,t=new d(s.state);if(e){let o=a.displayActions2e.find(p=>p.title.includes(e));o?t=o:a.displayActions2e.push(t)}return t}let m,u;Hooks.once("init",()=>{console.log(`Initializing ${l}`)});Hooks.on("getSceneControlButtons",s=>{let a=s.find(e=>e.name==="token");a==null||a.tools.push({name:"DisplayActions2e.ButtonName",title:"DisplayActions2e.ButtonHint",icon:"fa fa-angle-double-right",button:!0,onClick:async()=>{var e;u.render(!0),(e=game.socket)==null||e.emit("module.DisplayActions2e",{event:"DisplayActions2e"})}})});Hooks.on("ready",()=>{var s;m=game.modules.get(l),u=new d,m.displayActions2e=[u],(s=game.socket)==null||s.on(r,a=>{switch(a.operation){case"showToAll":L(a);break;case"showToSelection":g(a);break;case"showWithPermission":w(a);break;case"update":S(a);break;default:console.log(a);break}})});
//# sourceMappingURL=module.js.map
